# 传输控制层
传输控制层的协议：
- UDP
- TCP

    - 面向连接

        - 三次握手
            - 客户端发送同步请求 `syn`
            - 服务端返回同步响应与确认请求 `syn+ack`
            - 客户端返回确认响应 `ack`
            - 为什么要三次握手？
                - 客户端和服务端可以视作两个双向通信的节点
                - 第一次握手时为了告诉服务端，客户端的输出是正常的。（客户端：能听见我说话吗）
                - 第二次握手是服务端告诉客户端，服务端的输入正常，并且也能输出，同时希望确认客户端的输入是否正常 （服务端：能听见！你呢？）
                - 第三次握手是为了告诉服务端，客户端的输入是正常的。（客户端：我也听见了。）
        - 三次握手之后，双方都会为此连接分别开辟资源
        
        - 四次分手
            - 连接的断开代表资源的释放。
            - 客户端发送一个断开请求 `FIN`
            - 服务端返回一个 `FIN-ACK` 表示我收到了断开请求。但此时服务端客户端可能还有资源没传输完毕，连接还不能断开。
            - 当没有资源需要收发时，服务端发送一个 `FIN`
            - 客户端返回确认响应 `ACK`
    - 可靠的传输
        -三次握手之后，才会开始数据的传输
        -
    - SOCKET 可读可写 （套接字）
        - 代表了某一对连接 `IP + PORT -> IP + PORT`
            - `IP`: 主机
            - `port`: 进程/线程
        - 服务端固定占用一个端口号(22, 8080, 80)
        - 客户端随机占用一个端口（0-65535）
        - 客户端给 Sa 建立了65535个连接，之后仍然可以给 Sb 建立 65535个连接
        - socket -> fd 数字（文件描述符） -> worker 进程
        - 多个socket 对应一个进程： 多路复用器epoll

## 高并发
- 三次握手到四次分手不可分割
    - 高并发负载均衡 LVS 4 负载均衡。负载均衡不可以将三次握手，四次分手负载给两台不同的主机，否则会导致某台机器占用端口阻塞。


## 四次分手的抓包实操 (linux)
- `curl www.baidu.com` 访问www.baidu.com， 会收到响应
- `tcpdump -nn -i eth0 port 80` 监听80端口的TCP连接。 再加`-X` 详细内容